<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard - Letrify</title>
    <!-- Fuentes -->
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;700&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;700&family=Roboto:wght@400;500&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;500;700&family=Lato:wght@400;700&display=swap" rel="stylesheet">
    <!-- Bootstrap Icons -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons/font/bootstrap-icons.css" rel="stylesheet">
    <!-- Estilos -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="/css/global.css">
    <link rel="stylesheet" href="/css/dashboard.css">
    <!-- Scripts -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js" defer></script>
    <script src="/js/global.js" defer></script>
    <script src="/js/dashboard-main.js" defer></script>
    <script src="/js/documentFormHandler.js" defer></script>
    <script src="/js/documentsTable.js" defer></script>
    <script src="js/portfolioFormHandler.js" defer></script>
    <script src="js/portfolioTable.js" defer></script>
    <script src="js/portfolioDocumentsManager.js" defer></script>
    <script src="js/discountFormHandler.js" defer></script>
    <script src="js/discountModalHandler.js" defer></script>
    <script src="js/discountAccordion.js" defer></script>
</head>
<body>
    <div class="d-flex" id="wrapper">
        <!-- Sidebar -->
        <div class="bg-light" id="sidebar-wrapper">
            <div class="sidebar-heading bg-white text-center py-4 d-flex align-items-center justify-content-center">
                <img src="/img/letrify-logo.png" alt="Letrify Logo" class="me-2" style="height: 40px;"> 
                <span class="sidebar-title">Letrify</span>
            </div>
            <div class="list-group list-group-flush">
                <!-- Inicio -->
                <a href="#" class="list-group-item list-group-item-action bg-light bi bi-house-door" data-target="inicio"> Inicio</a>
        
                <!-- Gestión de Documentos -->
                <a href="#" class="list-group-item list-group-item-action bg-light bi bi-file-earmark-text" data-target="gestion-documentos">
                    Gestión de Documentos
                </a>
        
                <!-- Gestión de Carteras -->
                <a href="#" class="list-group-item list-group-item-action bg-light bi bi-folder" data-target="gestion-carteras">
                    Gestión de Carteras
                </a>
        
                <!-- Descuentos -->
                <a href="#" class="list-group-item list-group-item-action bg-light bi bi-cash-coin" data-target="descuentos">
                    Descuentos
                </a>

                <!-- Bancos y Tasas -->
                <div class="dropdown-sidebar">
                    <a href="#" class="list-group-item list-group-item-action bg-light bi bi-bank"> 
                        Bancos y Tasas
                        <i class="bi bi-chevron-down float-end"></i>
                    </a>
                    <div class="dropdown-content">
                        <a href="#" class="list-group-item list-group-item-action ps-4" data-target="lista-bancos">Lista de Bancos</a>
                        <a href="#" class="list-group-item list-group-item-action ps-4" data-target="tasas-bancarias">Tasas Bancarias</a>
                    </div>
                </div>
        
                <!-- Reportes -->
                <a href="#" class="list-group-item list-group-item-action bg-light bi bi-graph-up" data-target="reportes"> Reportes</a>
        
                <!-- Configuración -->
                <a href="#" class="list-group-item list-group-item-action bg-light bi bi-gear" data-target="configuracion"> Configuración</a>
        
                <!-- Cerrar Sesión -->
                <a href="#" class="list-group-item list-group-item-action bg-light bi bi-box-arrow-right text-danger"> Cerrar Sesión</a>
            </div>
        </div>
        <!-- /#sidebar-wrapper -->

        <!-- BOTÓN DE PRUEBA (eliminar) -->
        <!-- <form action="/logout" method="post">
            <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}">
            <button type="submit">Cerrar sesión</button>
        </form>     -->

        <!-- Overlay (Fondo Oscuro) -->
        <div id="overlay"></div>

        <!-- Page Content -->
        <div id="page-content-wrapper">
            <nav class="navbar navbar-expand-lg navbar-light bg-white border-bottom">
                <div class="container-fluid">
                    <button class="btn btn-primary" id="menu-toggle">☰</button>
                    <span class="navbar-brand ms-3">Dashboard</span>
                </div>
            </nav>

            <div class="container-fluid mt-4">
                <!-- Resumen Financiero -->
                <div id="inicio" class="content-section active">
                    <h2>Resumen Financiero</h2>
                    <div class="row">
                        <div class="col-md-4">
                            <div class="card text-white bg-success mb-3">
                                <div class="card-body">
                                    <h5 class="card-title">Total de Letras</h5>
                                    <p class="card-text display-6">25</p>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-4">
                            <div class="card text-white bg-info mb-3">
                                <div class="card-body">
                                    <h5 class="card-title">TCEA Promedio</h5>
                                    <p class="card-text display-6">12.5%</p>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-4">
                            <div class="card text-white bg-warning mb-3">
                                <div class="card-body">
                                    <h5 class="card-title">Valor Total Descontado</h5>
                                    <p class="card-text display-6">S/ 50,000</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Gestión de Documentos -->
                <div id="gestion-documentos" class="content-section">
                    <h2>Gestión de Documentos</h2>
                    <!-- Botón para abrir el modal -->
                    <button class="btn btn-primary mb-3" data-bs-toggle="modal" data-bs-target="#registerDocumentModal">
                        Agregar Nueva Letra/Factura
                    </button>

                    <!-- Tabla de Documentos Registrados -->
                    <div class="table-responsive d-none d-md-block">
                        <table class="table table-striped">
                            <thead>
                                <tr>
                                    <th>#</th>
                                    <th>Tipo</th>
                                    <th>N° Doc</th>
                                    <th>Cliente</th>
                                    <th>Monto</th>
                                    <th>Emisión</th>
                                    <th>Vencimiento</th>
                                    <th>Estado</th>
                                    <th>Acciones</th>
                                </tr>
                            </thead>
                            <tbody>
                            <!-- <tbody id="documentTableBody"> -->
                                <tr>
                                    <td colspan="9" class="text-center text-muted">Cargando documentos...</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>

                    <!-- Cards de Documentos para Móviles -->
                    <div class="d-md-none">
                        <div id="documentCardsContainer">
                            <!-- Mensaje de carga inicial (se reemplazará dinámicamente) -->
                            <p class="text-center text-muted">Cargando documentos...</p>
                        </div>
                    </div>

                    <!-- Modal de Registro -->
                    <div class="modal fade" id="registerDocumentModal" tabindex="-1" aria-labelledby="registerDocumentModalLabel" aria-hidden="true">
                        <div class="modal-dialog modal-dialog-centered modal-lg"> <!-- Agregamos 'modal-dialog-centered' -->
                            <div class="modal-content">
                                <div class="modal-header bg-primary text-white">
                                    <h5 class="modal-title" id="registerDocumentModalLabel">Registrar Documento</h5>
                                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                                </div>
                                <div class="modal-body">
                                    <form id="registerDocumentForm" method="POST" action="/documents/create">
                                        <div class="row">
                                            <div class="col-md-12 mb-3">
                                                <div class="form-floating">
                                                    <input type="text" id="customer" name="customer" class="form-control" placeholder="Cliente" required>
                                                    <label for="customer">Cliente</label>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="row">
                                            <div class="col-md-6 mb-3">
                                                <div class="form-floating">
                                                    <select id="documentType" name="documentType" class="form-select" required>
                                                        <option value="">Seleccione...</option>
                                                        <option value="FACTURA">Factura</option>
                                                        <option value="LETRA">Letra de Cambio</option>
                                                    </select>
                                                    <label for="documentType">Tipo de Documento</label>
                                                </div>
                                            </div>
                                            <div class="col-md-6 mb-3">
                                                <div class="form-floating">
                                                    <input id="documentNumber" type="text" name="documentNumber" class="form-control" placeholder="Número de Documento" required>
                                                    <label for="documentNumber">Número de Documento</label>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="row">
                                            <div class="col-md-6 mb-3">
                                                <div class="form-floating">
                                                    <input id="amount "type="number" name="amount" class="form-control" step="0.01" min="0" placeholder="Monto" required>
                                                    <label for="amount">Monto</label>
                                                </div>
                                            </div>
                                            <div class="col-md-6 mb-3">
                                                <div class="form-floating">
                                                    <select id="currency" name="currency" class="form-select" required>
                                                        <option value="">Seleccione...</option>
                                                        <option value="PEN">Soles (PEN)</option>
                                                        <option value="USD">Dólares (USD)</option>
                                                    </select>
                                                    <label for="currency">Moneda</label>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="row">
                                            <div class="col-md-6 mb-3">
                                                <div class="form-floating">
                                                    <input id="issueDate" type="date" name="issueDate" class="form-control" placeholder="Fecha de Emisión" required>
                                                    <label for="issueDate">Fecha de Emisión</label>
                                                </div>
                                            </div>
                                            <div class="col-md-6 mb-3">
                                                <div class="form-floating">
                                                    <input id="dueDate" type="date" name="dueDate" class="form-control" placeholder="Fecha de Vencimiento" required>
                                                    <label for="dueDate">Fecha de Vencimiento</label>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="row">
                                            <div class="col-12 mb-3">
                                                <div class="form-floating">
                                                    <textarea id="description" name="description" class="form-control" rows="3" placeholder="Descripción"></textarea>
                                                    <label for="description">Descripción</label>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="modal-footer">
                                            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancelar</button>
                                            <button type="submit" class="btn btn-primary">Guardar Documento</button>
                                        </div>
                                    </form>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Modal para Editar Documento -->
                    <div class="modal fade" id="editDocumentModal" tabindex="-1" aria-labelledby="editDocumentModalLabel" aria-hidden="true">
                        <div class="modal-dialog modal-dialog-centered modal-lg">
                            <div class="modal-content">
                                <div class="modal-header bg-warning text-dark">
                                    <h5 class="modal-title" id="editDocumentModalLabel">Editar Documento</h5>
                                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                                </div>
                                <div class="modal-body">
                                    <form id="editDocumentForm">
                                        <!-- Campo oculto para almacenar el ID del documento a editar -->
                                        <input type="hidden" name="documentId">

                                        <div class="row">
                                            <div class="col-md-12 mb-3">
                                                <div class="form-floating">
                                                    <input type="text" name="customer" class="form-control" placeholder="Cliente" required>
                                                    <label for="customer">Cliente</label>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="row">
                                            <div class="col-md-6 mb-3">
                                                <div class="form-floating">
                                                    <select name="documentType" class="form-select" required>
                                                        <option value="">Seleccione...</option>
                                                        <option value="FACTURA">Factura</option>
                                                        <option value="LETRA">Letra de Cambio</option>
                                                    </select>
                                                    <label for="documentType">Tipo de Documento</label>
                                                </div>
                                            </div>
                                            <div class="col-md-6 mb-3">
                                                <div class="form-floating">
                                                    <input type="text" name="documentNumber" class="form-control" placeholder="Número de Documento" required>
                                                    <label for="documentNumber">Número de Documento</label>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="row">
                                            <div class="col-md-6 mb-3">
                                                <div class="form-floating">
                                                    <input type="number" name="amount" class="form-control" step="0.01" min="0" placeholder="Monto" required>
                                                    <label for="amount">Monto</label>
                                                </div>
                                            </div>
                                            <div class="col-md-6 mb-3">
                                                <div class="form-floating">
                                                    <select name="currency" class="form-select" required>
                                                        <option value="">Seleccione...</option>
                                                        <option value="PEN">Soles (PEN)</option>
                                                        <option value="USD">Dólares (USD)</option>
                                                    </select>
                                                    <label for="currency">Moneda</label>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="row">
                                            <div class="col-md-6 mb-3">
                                                <div class="form-floating">
                                                    <input type="date" name="issueDate" class="form-control" placeholder="Fecha de Emisión" required>
                                                    <label for="issueDate">Fecha de Emisión</label>
                                                </div>
                                            </div>
                                            <div class="col-md-6 mb-3">
                                                <div class="form-floating">
                                                    <input type="date" name="dueDate" class="form-control" placeholder="Fecha de Vencimiento" required>
                                                    <label for="dueDate">Fecha de Vencimiento</label>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="row">
                                            <div class="col-12 mb-3">
                                                <div class="form-floating">
                                                    <textarea name="description" class="form-control" rows="3" placeholder="Descripción"></textarea>
                                                    <label for="description">Descripción</label>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="modal-footer">
                                            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancelar</button>
                                            <button type="submit" class="btn btn-warning" id="saveEditButton">Guardar Cambios</button>
                                        </div>
                                    </form>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Modal de Confirmación de Eliminación -->
                    <div class="modal fade" id="confirmDeleteModal" tabindex="-1" aria-labelledby="confirmDeleteModalLabel" aria-hidden="true">
                        <div class="modal-dialog modal-dialog-centered">
                            <div class="modal-content">
                                <div class="modal-header bg-danger text-white">
                                    <h5 class="modal-title" id="confirmDeleteModalLabel">Confirmar Eliminación</h5>
                                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                                </div>
                                <div class="modal-body text-center">
                                    <!-- Nueva imagen de alerta centrada -->
                                    <img src="img/alert-icon.png" alt="Alerta" class="alert-icon">
                    
                                    <!-- Texto de confirmación -->
                                    <p class="mt-3">¿Deseas eliminar el documento con número <strong id="deleteDocumentNumber"></strong>?</p>
                                </div>
                                <div class="modal-footer">
                                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancelar</button>
                                    <button type="button" class="btn btn-danger" id="confirmDeleteButton">Eliminar</button>
                                </div>
                            </div>
                        </div>
                    </div>

                </div>

                <!-- Gestión de Carteras -->
                <div id="gestion-carteras" class="content-section">
                    <h2>Gestión de Carteras</h2>
                    
                    <!-- Botón para agregar una nueva cartera -->
                    <button class="btn btn-primary mb-3" data-bs-toggle="modal" data-bs-target="#registerCarteraModal">
                        Agregar Nueva Cartera
                    </button>

                    <!-- Tabla de Carteras Registradas -->
                    <div class="table-responsive d-none d-md-block">
                        <table class="table table-striped">
                            <thead>
                                <tr>
                                    <th>#</th>
                                    <th>Nombre</th>
                                    <th>Fecha Creación</th>
                                    <th>Fecha Descuento</th>
                                    <th>Moneda</th>
                                    <th>Estado</th>
                                    <th>Documentos</th>
                                    <th>Cantidad</th>
                                    <th>Acciones</th>
                                </tr>
                            </thead>
                            <tbody id="portfolioTableBody">
                                <tr>
                                <!-- Aquí se insertarán dinámicamente las filas -->
                                    <!-- <td>1</td>
                                    <td>Cartera Enero</td>
                                    <td>01/01/2025</td>
                                    <td>15/01/2025</td>
                                    <td>PEN</td>
                                    <td><span class="badge bg-warning">Pendiente</span></td>
                                    <td>
                                        <button class="btn btn-sm btn-primary">Agregar</button>
                                        <button class="btn btn-sm btn-info">Ver</button>
                                    </td>
                                    <td><span class="badge bg-secondary">3</span></td>
                                    <td>
                                        <button class="btn btn-sm btn-warning">Editar</button>
                                        <button class="btn btn-sm btn-danger">Eliminar</button>
                                    </td> -->
                                </tr>
                            </tbody>
                        </table>
                    </div>

                    <!-- Cards para vista móvil -->
                    <div class="d-md-none">
                        <div id="portfolioCardsContainer">
                            <!-- Mensaje de carga inicial (se reemplazará dinámicamente) -->
                            <p class="text-center text-muted">Cargando documentos...</p>
                            <!-- <div class="card mb-3">
                                <div class="card-body">
                                    <h5 class="card-title">Cartera Enero</h5>
                                    <p class="card-text"><strong>Fecha Creación:</strong> 01/01/2025</p>
                                    <p class="card-text"><strong>Fecha Descuento:</strong> 15/01/2025</p>
                                    <p class="card-text"><strong>Moneda:</strong> PEN</p>
                                    <p class="card-text"><strong>Estado:</strong> <span class="badge bg-warning">Pendiente</span></p>
                                    <p class="card-text"><strong>Documentos:</strong> <span class="badge bg-secondary">3</span></p>
                                    <div class="d-flex justify-content-between">
                                        <button class="btn btn-primary btn-sm">Agregar</button>
                                        <button class="btn btn-info btn-sm">Ver</button>
                                    </div>
                                    <div class="d-flex justify-content-between mt-2">
                                        <button class="btn btn-warning btn-sm">Editar</button>
                                        <button class="btn btn-danger btn-sm">Eliminar</button>
                                    </div>
                                </div>
                            </div> -->
                        </div>
                    </div>

                    <!-- Modal Bootstrap para Nueva Cartera -->
                    <div class="modal fade" id="registerCarteraModal" tabindex="-1" aria-labelledby="registerCarteraModalLabel" aria-hidden="true">
                        <div class="modal-dialog modal-dialog-centered">
                            <div class="modal-content">
                                <div class="modal-header bg-primary text-white">
                                    <h5 class="modal-title" id="registerCarteraModalLabel">Registrar Nueva Cartera</h5>
                                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                                </div>
                                <div class="modal-body">
                                    <form id="registerCarteraForm">
                                        <!-- Nombre de la Cartera -->
                                        <div class="mb-3 form-floating">
                                            <input type="text" id="carteraName" class="form-control" placeholder="Nombre de la Cartera" required>
                                            <label for="carteraName">Nombre de la Cartera</label>
                                        </div>
                    
                                        <!-- Descripción -->
                                        <div class="mb-3 form-floating">
                                            <textarea id="carteraDescription" class="form-control" placeholder="Descripción de la cartera"></textarea>
                                            <label for="carteraDescription">Descripción (Opcional)</label>
                                        </div>
                    
                                        <!-- Fecha de Descuento -->
                                        <div class="mb-3 form-floating">
                                            <input type="date" id="discountDate" class="form-control" required>
                                            <label for="discountDate">Fecha de Descuento</label>
                                        </div>
                    
                                        <!-- Moneda -->
                                        <div class="mb-3 form-floating">
                                            <select id="carteraCurrency" class="form-select" required>
                                                <option value="PEN">Soles (PEN)</option>
                                                <option value="USD">Dólares (USD)</option>
                                            </select>
                                            <label for="carteraCurrency">Moneda</label>
                                        </div>
                    
                                        <!-- Estado (Pendiente por defecto, oculto) -->
                                        <input type="hidden" id="carteraStatus" value="PENDIENTE">
                    
                                        <!-- Botones de acción -->
                                        <div class="modal-footer">
                                            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancelar</button>
                                            <button type="submit" class="btn btn-primary">Guardar Cartera</button>
                                        </div>
                                    </form>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Modal para Seleccionar Documentos -->
                    <div class="modal fade" id="selectDocumentsModal" tabindex="-1" aria-labelledby="selectDocumentsModalLabel" aria-hidden="true">
                        <div class="modal-dialog modal-lg">
                            <div class="modal-content">
                                <div class="modal-header bg-primary text-white">
                                    <h5 class="modal-title" id="selectDocumentsModalLabel">Seleccionar Documentos</h5>
                                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Cerrar"></button>
                                </div>
                                <div class="modal-body">
                                    <p><strong>Cartera:</strong> <span id="selectedPortfolioName"></span></p>
                                    <p><strong>Moneda:</strong> <span id="selectedPortfolioCurrency"></span></p>

                                    <!-- Lista de Documentos Disponibles -->
                                    <div class="list-group" id="documentList">
                                        <!-- Los documentos disponibles se cargarán dinámicamente aquí -->
                                    </div>
                                </div>
                                <div class="modal-footer">
                                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancelar</button>
                                    <button type="button" class="btn btn-primary" id="saveSelectedDocuments">Guardar</button>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Modal para Ver Documentos de una Cartera -->
                    <div class="modal fade" id="viewDocumentsModal" tabindex="-1" aria-labelledby="viewDocumentsModalLabel" aria-hidden="true">
                        <div class="modal-dialog modal-lg">
                            <div class="modal-content">
                                <div class="modal-header bg-secondary text-white">
                                    <h5 class="modal-title" id="viewDocumentsModalLabel">Documentos en la Cartera</h5>
                                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Cerrar"></button>
                                </div>
                                <div class="modal-body">
                                    <p><strong>Cartera:</strong> <span id="viewPortfolioName"></span></p>
                                    <p><strong>Moneda:</strong> <span id="viewPortfolioCurrency"></span></p>

                                    <!-- Tabla de Documentos en la Cartera -->
                                    <div class="table-responsive">
                                        <table class="table table-striped">
                                            <thead>
                                                <tr>
                                                    <th>#</th>
                                                    <th>Número</th>
                                                    <th>Monto</th>
                                                    <th>Fecha Vencimiento</th>
                                                    <th>Acciones</th>
                                                </tr>
                                            </thead>
                                            <tbody id="viewDocumentsTableBody">
                                                <!-- Los documentos se cargarán dinámicamente aquí -->
                                            </tbody>
                                        </table>
                                    </div>
                                </div>
                                <div class="modal-footer">
                                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cerrar</button>
                                </div>
                            </div>
                        </div>
                    </div>

                </div>

                <!-- Sección de Descuentos -->
                <div id="descuentos" class="content-section">
                    <h2 class="mb-4">Gestión de Descuentos</h2>

                    <!-- Botón para agregar un nuevo descuento -->
                    <button class="btn btn-primary mb-3" data-bs-toggle="modal" data-bs-target="#addDiscountModal">
                        Agregar Nuevo Descuento
                    </button>

                    <!-- Buscador en vivo con icono de lupa y botón de limpiar -->
                    <div class="input-group mb-3 search-container">
                        <span class="input-group-text"><i class="bi bi-search"></i></span>
                        <input type="text" id="discountSearch" class="form-control search-input" placeholder="Buscar descuento...">
                        <button id="clearSearch" class="btn btn-light btn-clear" type="button">
                            <i class="bi bi-x-circle"></i>
                        </button>
                    </div>

                    <!-- Listado de Descuentos -->
                    <div class="container mt-4">
                    
                        <!-- Contenedor con scroll -->
                        <div class="discounts-container">
                            <div class="accordion" id="discountsAccordion">
                                <!-- Descuentos se cargarán aquí dinámicamente -->
                            </div>
                        </div>
                    </div>                    

                    <!-- Modal para Agregar Descuento -->
                    <div class="modal fade" id="addDiscountModal" tabindex="-1" aria-labelledby="addDiscountModalLabel" aria-hidden="true">
                        <div class="modal-dialog modal-lg modal-dialog-centered"> <!-- Modal más ancho y centrado -->
                            <div class="modal-content">
                                <div class="modal-header bg-primary text-white">
                                    <h5 class="modal-title" id="addDiscountModalLabel">Agregar Nuevo Descuento</h5>
                                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                                </div>
                                <div class="modal-body">
                                    <form id="addDiscountForm">
                                        
                                        <!-- Fila con los campos principales -->
                                        <div class="row row-cols-1 row-cols-md-3 g-3">
                                            
                                            <!-- Selección de la Cartera de Documentos -->
                                            <div class="col">
                                                <div class="form-floating">
                                                    <select id="portfolioId" class="form-select" required>
                                                        <option value="" selected disabled>Seleccione una Cartera</option>
                                                        <!-- Opciones dinámicas desde la base de datos -->
                                                    </select>
                                                    <label for="portfolioId">Cartera de Documentos</label>
                                                </div>
                                            </div>

                                            <!-- Fecha del Descuento -->
                                            <div class="col">
                                                <div class="form-floating">
                                                    <input type="date" id="discountDiscountDate" class="form-control" required>
                                                    <label for="discountDate">Fecha del Descuento</label>
                                                </div>
                                            </div>

                                            <!-- Selección del Banco -->
                                            <div class="col">
                                                <div class="form-floating">
                                                    <select id="bankId" class="form-select" required>
                                                        <option value="" selected disabled>Seleccione un Banco</option>
                                                        <!-- Opciones dinámicas desde la base de datos -->
                                                    </select>
                                                    <label for="bankId">Banco</label>
                                                </div>
                                                <div class="clearfix"></div> <!-- Evita solapamientos -->
                                            </div>

                                        </div>

                                        <!-- 📌 Tabla de Costos del Banco (Pantallas Grandes) -->
                                        <div class="mt-3 d-none d-md-block">
                                            <div id="bankFeesContainerTable" class="mt-2" style="display: none;">
                                                <h6>Costos del Banco Seleccionado</h6>
                                                <div class="table-scrollable"> <!-- Contenedor scrollable -->
                                                    <table class="table table-bordered table-sm">
                                                        <thead>
                                                            <tr>
                                                                <th>Nombre</th>
                                                                <th>Tipo</th>
                                                                <th>Monto</th>
                                                                <th>Aplicación</th>
                                                                <th>Origen</th> <!-- Nueva columna -->
                                                            </tr>
                                                        </thead>
                                                        <tbody id="bankFeesTableBody">
                                                            <!-- Aquí se llenarán los costos dinámicamente -->
                                                        </tbody>
                                                    </table>
                                                </div>

                                                <!-- 📌 Botón para agregar costos manuales (solo visible cuando la tabla está visible) -->
                                                <button type="button" id="btnAddManualCostTable" class="btn btn-outline-primary btn-sm mb-3" style="display: none;">
                                                    + Agregar Otros Costos
                                                </button>

                                                <!-- 📌 Formulario desplegable para agregar costos manuales -->
                                                <div id="manualCostFormTable" class="border p-3 mb-3 rounded" style="display: none;">
                                                    <div class="row g-2 align-items-end">
                                                        <div class="col-md-4">
                                                            <input type="text" id="manualCostNameTable" class="form-control form-control-sm" placeholder="Nombre de costo adicional">
                                                        </div>
                                                        <div class="col-md-2">
                                                            <select id="manualCostTypeTable" class="form-select form-select-sm">
                                                                <option value="FIJO">Fijo</option>
                                                                <option value="PORCENTUAL">Porcentual</option>
                                                                <option value="RETENCION">Retención</option>
                                                            </select>
                                                        </div>
                                                        <div class="col-md-2">
                                                            <input type="number" id="manualCostAmountTable" name="manualCostAmountTable" class="form-control form-control-sm" placeholder="Monto">
                                                        </div>
                                                        <div class="col-md-2">
                                                            <select id="manualCostTimingTable" class="form-select form-select-sm">
                                                                <option value="INICIAL">Inicial</option>
                                                                <option value="FINAL">Final</option>
                                                            </select>
                                                        </div>
                                                        <div class="col-md-2 text-end">
                                                            <button type="button" class="btn btn-success btn-sm" id="btnSaveManualCostTable">Agregar</button>
                                                            <button type="button" class="btn btn-secondary btn-sm" id="btnCancelManualCostTable">X</button>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>

                                        <!-- 📌 Lista de Costos del Banco (Pantallas Pequeñas) -->
                                        <div class="mt-3 d-md-none">
                                            <div id="bankFeesContainerList" class="mt-2" style="display: none;">
                                                <h6>Costos del Banco Seleccionado</h6>
                                                <div class="list-scrollable" id="bankFeesListBody">
                                                    <!-- Aquí se llenarán los costos dinámicamente -->
                                                </div>

                                                <!-- 📌 Botón para agregar costos manuales (solo visible cuando la lista está visible) -->
                                                <button type="button" id="btnAddManualCostList" class="btn btn-outline-primary btn-sm mt-3 mb-3" style="display: none;">
                                                    + Agregar Otros Costos
                                                </button>

                                                <!-- 📌 Formulario desplegable para agregar costos manuales en móviles -->
                                                <div type="button" id="manualCostFormList" class="border p-3 mb-3 rounded" style="display: none;">
                                                    <div class="row g-2 align-items-end">
                                                        <div class="col-12">
                                                            <input type="text" id="manualCostNameList" class="form-control form-control-sm" placeholder="Nombre de costo adicional">
                                                        </div>
                                                        <div class="col-6">
                                                            <select id="manualCostTypeList" class="form-select form-select-sm">
                                                                <option value="FIJO">Fijo</option>
                                                                <option value="PORCENTUAL">Porcentual</option>
                                                                <option value="RETENCION">Retención</option>
                                                            </select>
                                                        </div>
                                                        <div class="col-6">
                                                            <input type="number" id="manualCostAmountList" name="manualCostAmountList" class="form-control form-control-sm" placeholder="Monto">
                                                        </div>
                                                        <div class="col-6">
                                                            <select id="manualCostTimingList" class="form-select form-select-sm">
                                                                <option value="INICIAL">Inicial</option>
                                                                <option value="FINAL">Final</option>
                                                            </select>
                                                        </div>
                                                        <div class="col-6 d-flex gap-2">
                                                            <button type="button" class="btn btn-success btn-sm flex-grow-1" id="btnSaveManualCostList">Agregar</button>
                                                            <button type="button" class="btn btn-secondary btn-sm" id="btnCancelManualCostList">X</button>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>

                                        <!-- 📌 Fila con 4 columnas -->
                                        <div class="row row-cols-1 row-cols-md-4 mb-3 g-3">
    
                                            <!-- Tipo de Tasa -->
                                            <div class="col">
                                                <div class="form-floating">
                                                    <select id="rateType" class="form-select" required>
                                                        <option value="NOMINAL">Nominal</option>
                                                        <option value="EFECTIVA">Efectiva</option>
                                                    </select>
                                                    <label for="rateType">Tipo de Tasa</label>
                                                </div>
                                            </div>
                                        
                                            <!-- Período de la Tasa -->
                                            <div class="col">
                                                <div class="form-floating">
                                                    <input type="number" id="rateDays" class="form-control" min="1" required>
                                                    <label for="rateDays">Período de la Tasa (días)</label>
                                                </div>
                                            </div>

                                            <!-- Tasa Aplicada -->
                                            <div class="col">
                                                <div class="form-floating">
                                                    <input type="number" id="rate" class="form-control" step="0.00001" min="0" required>
                                                    <label for="rate">Tasa Aplicada (%)</label>
                                                </div>
                                            </div>

                                            <!-- Capitalización (Solo si la tasa es nominal) -->
                                            <div class="col" id="capitalizationRow" style="display: none;">
                                                <div class="form-floating">
                                                    <input type="number" id="capitalizationDays" class="form-control" min="1">
                                                    <label for="capitalizationDays">Capitalización (días)</label>
                                                </div>
                                            </div>
                                    
                                        </div>

                                        <!-- Tipo de Cambio USD → PEN (Collapse Clickable) -->
                                        <div class="col">
                                            <div class="border rounded p-2 bg-light">

                                                <!-- ID Oculto -->
                                                <input type="hidden" id="exchangeRateId" value="">

                                                <!-- Sección Clickable -->
                                                <div class="d-flex justify-content-between align-items-center" data-bs-toggle="collapse" data-bs-target="#exchangeRateDetails" style="cursor: pointer;">
                                                    <h6 class="mb-0"><strong>Tipo de Cambio (USD → PEN)</strong></h6>
                                                    <span class="text-primary"><i class="bi bi-chevron-down"></i></span>
                                                </div>
                                        
                                                <!-- Contenedor de detalles colapsables -->
                                                <div id="exchangeRateDetails" class="collapse mt-2">
                                                    <ul class="list-unstyled">
                                                        <li><strong>Valor de Compra:</strong> <span id="exchangeRate">Cargando...</span></li>
                                                        <li><strong>Fecha del Tipo de Cambio:</strong> <span id="exchangeDate">Cargando...</span></li>
                                                        <li><strong>Fuente de Información:</strong> <span id="source">Cargando...</span></li>
                                                        <li><strong>Última Actualización:</strong> <span id="lastUpdated">Cargando...</span></li>
                                                    </ul>
                                                </div>
                                            </div>
                                        </div>

                                        <!-- Botones de acción -->
                                        <div class="modal-footer mt-3">
                                            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancelar</button>
                                            <button type="submit" class="btn btn-primary">Guardar Descuento</button>
                                        </div>

                                    </form>
                                </div>
                            </div>
                        </div>
                    </div>

                </div>

                <!-- Reportes -->
                <div id="reportes" class="content-section">
                    <h2>Reportes</h2>
                    <div class="mb-3">
                        <button class="btn btn-success">Generar Reporte PDF</button>
                        <button class="btn btn-secondary">Exportar a Excel</button>
                    </div>
                </div>

                <!-- Configuración -->
                <div id="configuracion" class="content-section">
                    <h2>Configuración</h2>
                    <p>Aquí puedes ajustar las configuraciones de tu cuenta y preferencias.</p>
                </div>
            </div>
        </div>
        <!-- /#page-content-wrapper -->
    </div>

<!-- JavaScript para el buscador en vivo y limpiar búsqueda -->
<script>
    document.getElementById("discountSearch").addEventListener("keyup", function() {
        let filter = this.value.toLowerCase();
        let cards = document.querySelectorAll(".discount-card");
    
        cards.forEach(card => {
            let name = card.getAttribute("data-name").toLowerCase();
            if (name.includes(filter)) {
                card.style.display = "block";
            } else {
                card.style.display = "none";
            }
        });
    });
    
    // Botón para limpiar la búsqueda
    document.getElementById("clearSearch").addEventListener("click", function() {
        document.getElementById("discountSearch").value = "";
        let cards = document.querySelectorAll(".discount-card");
        cards.forEach(card => card.style.display = "block");
    });
</script>

</body>
</html>
